(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{819:function(e,t,r){var content=r(833);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(47).default)("f92a0b70",content,!0,{sourceMap:!1})},831:function(e,t,r){"use strict";var n=r(59),o=r(12),l=r(60),c=r(389),d=r(390),m=r(48),h=r(393),_=r(391);o(o.S+o.F*!r(392)((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,o,f,y=l(e),v="function"==typeof this?this:Array,x=arguments.length,w=x>1?arguments[1]:void 0,k=void 0!==w,S=0,L=_(y);if(k&&(w=n(w,x>2?arguments[2]:void 0,2)),null==L||v==Array&&d(L))for(r=new v(t=m(y.length));t>S;S++)h(r,S,k?w(y[S],S):y[S]);else for(f=L.call(y),r=new v;!(o=f.next()).done;S++)h(r,S,k?c(f,w,[o.value,S],!0):o.value);return r.length=S,r}})},832:function(e,t,r){"use strict";var n=r(819);r.n(n).a},833:function(e,t,r){(t=r(46)(!1)).push([e.i,"iframe[data-v-6c17e96a]{width:100%;height:100%;overflow:visible;border:0}",""]),e.exports=t},861:function(e,t,r){"use strict";r.r(t);r(29),r(15),r(114),r(831),r(40);var n=r(6),o=(r(113),r(0)),l=r.n(o),c={validate:function(e){var t=e.params;return/^\d+$/.test(t.id)},data:function(){return{iframe:{height:200,src:"/",fullscreen:!1},match:{game:{has_replay_player:!1}},messageObj:{},player_controller:{initted:!1,number_of_frames:0,current_frame:0,is_playing:!1,play_speed:1,timer:null},debug:{open:!1,header:"",content:""}}},computed:{game_player:function(){return this.$refs["game-player"]},player_percent:function(){return this.player_controller.number_of_frames?Math.round(100*this.player_controller.current_frame/this.player_controller.number_of_frames):100}},watch:{"player_controller.current_frame":function(e,t){e!=t&&(e==t+1?this.playerLoadNextFrame():this.playerLoadFrame())},"player_controller.is_playing":function(e,t){var r=this;e!=t&&(this.player_controller.timer&&(clearInterval(this.player_controller.timer),this.player_controller.timer=null),e&&(this.player_controller.timer=setInterval((function(){r.playNextFrame()}),1e3/this.player_controller.play_speed)))},"player_controller.play_speed":function(e,t){var r=this;e!=t&&this.player_controller.is_playing&&(clearInterval(this.player_controller.timer),this.player_controller.timer=setInterval((function(){r.playNextFrame()}),1e3/e))}},head:function(){return{title:"对局 #".concat(this.match.id," - Saiblo")}},asyncData:function(e){return e.app.$axios.get("/api/matches/".concat(e.route.params.id,"/")).then(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o,i,l,c,d,m,h,_,f,y,v,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=["rgba(130, 57, 54, 0.5)","rgba(137, 190, 178, 0.5)","rgba(201, 186, 131, 0.5)","rgba(222, 211, 140, 0.5)","rgba(222, 156, 83, 0.5)"],n=Array(t.data.info.length),o=Array(t.data.info.length),i=0;i<n.length;i++)n[i]=[],o[i]=[];for(l=JSON.parse(t.data.records),c=0;c<l.length;c++)for(d=l[c],m=0;m<d.length;m++)n[d[m].position].push({x:c,y:d[m].time.toFixed(2)}),o[d[m].position].push({x:c,y:(d[m].memory/1024/1024).toFixed(2)});for(h=[],_=[],f=0;f<t.data.info.length;f++)(y=t.data.info[f]).code?(h.push({label:y.user.username+" 的 "+y.code.entity+"("+y.code.version+")",data:n[f],backgroundColor:r[f],borderColor:r[f],fill:!1}),_.push({label:y.user.username+" 的 "+y.code.entity+"("+y.code.version+")",data:o[f],backgroundColor:r[f],borderColor:r[f],fill:!1})):h.push({label:y.user.username,data:n[f],backgroundColor:r[f],borderColor:r[f],fill:!1});return v={layout:{height:"400px"},responsive:!0,title:{display:!0,text:"每回合玩家用时"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"回合"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"用时(ms)"}}]}},x={layout:{height:"400px"},responsive:!0,title:{display:!0,text:"每回合AI使用内存"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"回合"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"内存(MB)"}}]}},e.abrupt("return",{match:t.data,chartdata:{labels:Array.from(Array(l.length).keys()),datasets:h},chartdata_m:{labels:Array.from(Array(l.length).keys()),datasets:_},options:v,options_m:x});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(){e.error({statusCode:404,message:"没有这场对局"})}))},beforeDestroy:function(){clearInterval(this.player_controller.timer)},mounted:function(){window.addEventListener("message",this.receiveMessage,!1)},methods:{showDebug:function(e){this.debug.header=e.code.entity+" ver."+e.code.version+" 的调试信息",this.debug.open=!0},beautifyTime:function(e){return l()(e).lang("en").format("YYYY-MM-DD HH:mm:ss")},download_replay:function(e){this.$axios({url:"/api/matches/".concat(e,"/download/"),method:"GET",responseType:"blob"}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=t,r.setAttribute("download","replay.json"),document.body.appendChild(r),r.click()}))},onLoad:function(){var e=this;this.iframe.height=this.game_player.contentDocument.body.scrollHeight+30,"评测成功"==this.match.state&&this.$axios({url:"/api/matches/".concat(this.$route.params.id,"/download/"),method:"GET",responseType:"blob"}).then((function(t){e.postMessage({message:"init_replay_player",replay_data:t.data});for(var r=[],i=0;i<e.match.info.length;i++){var n=e.match.info[i];n.code?r.push(n.user.username+" 的 "+n.code.entity+"("+n.code.version+")"):r.push(n.user.username)}e.postMessage({message:"load_players",players:r})}))},postMessage:function(data){this.game_player.contentWindow.postMessage(data,this.iframe.src)},receiveMessage:function(e){switch(e.data.message){case"init_successfully":"评测成功"==this.match.state&&(this.player_controller.number_of_frames=e.data.number_of_frames,this.player_controller.initted=!0);break;case"resized":this.iframe.height=this.game_player.contentDocument.body.scrollHeight+30}},playerLoadFrame:function(){this.postMessage({message:"load_frame",index:this.player_controller.current_frame})},playerLoadNextFrame:function(){this.postMessage({message:"load_next_frame"})},previousFrame:function(){this.player_controller.current_frame&&this.player_controller.current_frame--,this.player_controller.is_playing=!1},nextFrame:function(){this.player_controller.current_frame<this.player_controller.number_of_frames&&this.player_controller.current_frame++,this.player_controller.is_playing=!1},playNextFrame:function(){this.player_controller.current_frame<this.player_controller.number_of_frames?this.player_controller.current_frame++:this.player_controller.is_playing=!1},changeSpeed:function(){this.player_controller.play_speed<4?this.player_controller.play_speed*=2:this.player_controller.play_speed=1},resetPlayer:function(){this.player_controller.current_frame=0,this.player_controller.is_playing=!1},getColor:function(e){switch(e){case"OK":return"yellowgreen";case"TLE":return"goldenrod";case"MLE":return"steelblue";case"RE":return"mediumpurple"}},getState:function(e){switch(e){case"OK":return"No Problem";case"TLE":return"Time Limit Exceed";case"MLE":return"Memory Limit Exceed";case"RE":return"Runtime Error"}}}},d=(r(832),r(7)),component=Object(d.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("sui-breadcrumb",[e.match.contest&&"{}"!==JSON.stringify(e.match.contest)?r("span",[r("sui-breadcrumb-section",[r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/group/"+e.match.contest.group.id+"/"}},[e._v(e._s(e.match.contest.group.name))])],1),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/group/"+e.match.contest.group.id+"/contest/"+e.match.contest.id}},[e._v(e._s(e.match.contest.name))])],1):r("span",[r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/games"}},[e._v("游戏")]),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/game/"+e.match.game.id}},[e._v("\n        "+e._s(e.match.game.alias)+"\n      ")])],1),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{attrs:{active:""}},[e._v("对局")])],1),e._v(" "),r("sui-grid",{attrs:{stackable:""}},[r("sui-grid-row",[r("sui-grid-column",[r("sui-header",{tag:"h1"},[e._v("对局 #"+e._s(e.match.id))])],1)],1),e._v(" "),r("sui-grid-row",[r("sui-grid-column",{attrs:{width:12}},[r("sui-segment",[r("div",{staticClass:"f sb ce",staticStyle:{"margin-bottom":"20px"}},[r("div",[r("span",{staticStyle:{color:"grey"}},[e._v("\n                对局时间："+e._s(e.beautifyTime(e.match.create_time))+" 当前状态：\n              ")]),e._v(" "),r("span",{style:"color: "+("准备中"==e.match.state?"grey":"评测中"==e.match.state?"orange":"评测失败"==e.match.state?"red":"green")},[e._v(e._s(e.match.state))])]),e._v(" "),r("sui-button",{attrs:{size:"mini",color:"blue",basic:""},nativeOn:{click:function(t){return e.download_replay(e.match.id)}}},[e._v("下载回放")])],1),e._v(" "),e.match.game.has_replay_player?r("iframe",{ref:"game-player",style:e.iframe.fullscreen?"position: fixed; top: 0; left: 0; z-index: 10000; width: 100%; height: 100%;":"width: 100%; height: "+e.iframe.height+"px;",attrs:{src:e.$staticFileCORS("/"+e.match.game.name+"/player.html"),scrolling:"auto"},on:{load:function(t){return e.onLoad()}}}):r("div",[r("sui-dimmer-dimmable",[r("sui-image",{attrs:{src:e.$staticFile("/"+e.match.game.name+"/cover.png")}}),e._v(" "),r("sui-dimmer",{attrs:{active:""}},[r("sui-container",{staticStyle:{"font-size":"2em","font-weight":"thick"},attrs:{"text-align":"center"}},[e._v("该游戏无网页版播放器，请下载播放器并离线播放")])],1)],1)],1),e._v(" "),"评测成功"==e.match.state&&e.player_controller.initted?r("div",{class:e.iframe.fullscreen?"f cr ce":"f c ce",style:e.iframe.fullscreen?"position: fixed; bottom: 0; left: 0; margin: auto; z-index: 10001; width: 100%;":""},[r("sui-progress",{staticStyle:{"margin-bottom":"0",width:"100%"},attrs:{state:"active",color:"violet",percent:e.player_percent,progress:""}}),e._v(" "),r("sui-button-group",{attrs:{color:"grey"}},[r("sui-button",{attrs:{icon:"chevron left"},on:{click:function(t){return t.preventDefault(),e.previousFrame()}}}),e._v(" "),r("sui-button",{attrs:{icon:"chevron right"},on:{click:function(t){return t.preventDefault(),e.nextFrame()}}}),e._v(" "),r("sui-button",{attrs:{icon:e.player_controller.is_playing?"stop":"play"},on:{click:function(t){t.preventDefault(),e.player_controller.is_playing=!e.player_controller.is_playing}}}),e._v(" "),r("sui-button",{staticStyle:{padding:"11px"},on:{click:function(t){return t.preventDefault(),e.changeSpeed()}}},[e._v(e._s(e.player_controller.play_speed)+"X")]),e._v(" "),r("sui-button",{attrs:{icon:"undo"},on:{click:function(t){return t.preventDefault(),e.resetPlayer()}}}),e._v(" "),r("sui-popup",{attrs:{content:e.iframe.fullscreen?"退出全屏":"全屏模式"}},[r("sui-button",{attrs:{slot:"trigger",icon:e.iframe.fullscreen?"compress":"expand"},on:{click:function(t){t.preventDefault(),e.iframe.fullscreen=!e.iframe.fullscreen}},slot:"trigger"})],1)],1)],1):e._e()]),e._v(" "),r("sui-segment",[r("time-chart",{attrs:{height:200,chartdata:e.chartdata,options:e.options}})],1),e._v(" "),r("sui-segment",[r("time-chart",{attrs:{height:200,chartdata:e.chartdata_m,options:e.options_m}})],1)],1),e._v(" "),r("sui-grid-column",{attrs:{width:4}},[r("sui-table",[r("sui-table-body",e._l(e.match.info,(function(t,n){return r("sui-table-row",{key:n},[r("sui-table-cell",{style:"position: relative; padding-top: 20px; background-color: "+(t.code?"unset;":"aliceblue;")},[r("div",{style:"position: absolute; top: -1px; right: -1px; background-color: "+e.getColor(t.end_state)+"; padding: 1px 3px; font-size: .6rem; color: white; border-top-right-radius: inherit; border-bottom-left-radius: inherit;"},[e._v("\n                  "+e._s(e.getState(t.end_state))+"\n                ")]),e._v(" "),r("sui-image",{staticStyle:{float:"left","margin-right":"1em"},attrs:{size:"mini",src:"https://cdn.v2ex.com/gravatar/"+t.user.email_md5+"?s=1000&d=mm"}}),e._v(" "),r("div",[r("b",{staticStyle:{"font-size":"large"}},[r("nuxt-link",{attrs:{to:"/user/"+t.user.username}},[e._v("\n                      "+e._s(t.user.username)+"\n                    ")])],1)]),e._v(" "),r("div",{staticStyle:{color:"grey","font-size":"small"}},[e._v("\n                  "+e._s(t.user.name)+"\n                  "+e._s(t.user.school)+"\n                  "+e._s(t.user.department)+"\n                ")]),e._v(" "),r("div",[e._v("\n                  排名："+e._s(t.rank)+"\n                  "),r("span",{staticStyle:{float:"right"}},[e._v(e._s(t.score)+"pts.")])]),e._v(" "),r("div",{staticStyle:{"text-align":"center"}},[t.code?r("div",[r("sui-label",{attrs:{color:"blue",size:"mini"}},[e._v("\n                      "+e._s(t.code.entity)+"\n                      "),r("sui-label-detail",[e._v("ver."+e._s(t.code.version))])],1),e._v(" "),r("sui-popup",{attrs:{content:"点击查看程序输出的调试信息",inverted:""}},[r("sui-label",{tag:"a",attrs:{slot:"trigger",size:"mini",color:"purple"},on:{click:function(r){return e.showDebug(t)}},slot:"trigger"},[r("sui-icon",{staticStyle:{"margin-right":"0"},attrs:{name:"bug"}})],1)],1)],1):r("sui-label",{attrs:{color:"olive",size:"mini"}},[e._v("人类玩家")])],1)],1)],1)})),1)],1)],1)],1)],1),e._v(" "),r("sui-modal",{staticStyle:{"z-index":"10002"},model:{value:e.debug.open,callback:function(t){e.$set(e.debug,"open",t)},expression:"debug.open"}},[r("sui-modal-header",[e._v(e._s(e.debug.header))]),e._v(" "),r("sui-modal-content",{staticStyle:{"background-color":"lightgrey"},attrs:{scrolling:""}},[e._v("\n      "+e._s(e.debug.content)+"\n    ")])],1)],1)}),[],!1,null,"6c17e96a",null);t.default=component.exports}}]);