(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{848:function(r,e,o){"use strict";o.r(e);o(28);var t=o(21),m=t.helpers.regex("is_id_number",/^[0-9]{17}[0-9|X|x]$/),d={data:function(){return{cardOneActive:!1,cardTwoActive:!1,profile_form:{username:this.$auth.$state.user.username,email:this.$auth.$state.user.email,name:this.$auth.$state.user.name,sex:this.$auth.$state.user.sex,school:this.$auth.$state.user.school,department:this.$auth.$state.user.department,biography:this.$auth.$state.user.biography,isLoading:!1,isOK:!1,err_code:0,err_msg:""},password_form:{username:this.$auth.$state.user.username,old_password:"",password:"",confirm_password:"",isLoading:!1,isOK:!1,err_code:0,err_msg:""},private_form:{id_number:this.$auth.$state.user.id_number,credit_card_number:this.$auth.$state.user.credit_card_number,bank_of_deposit:this.$auth.$state.user.bank_of_deposit,isLoading:!1,isOK:!1},sex_options:[{value:"男",icon:"blue mars",text:"男"},{value:"女",icon:"red venus",text:"女"},{value:"保密",icon:"grey genderless",text:"保密"}]}},validations:{profile_form:{name:{maxLength:Object(t.maxLength)(20)},sex:{},school:{maxLength:Object(t.maxLength)(20)},department:{maxLength:Object(t.maxLength)(20)},username:{},email:{},biography:{maxLength:Object(t.maxLength)(200)}},password_form:{old_password:{required:t.required},password:{required:t.required},confirm_password:{required:t.required,sameAs:Object(t.sameAs)("password")}},private_form:{id_number:{is_id_number:m},credit_card_number:{integer:t.integer,minLength:Object(t.minLength)(16),maxLength:Object(t.maxLength)(19)},bank_of_deposit:{}}},watch:{"password_form.old_password":function(){this.password_form.err_code=0}},mounted:function(){},methods:{edit_profile:function(){var r=this;this.$v.profile_form.$touch(),this.$v.profile_form.$invalid||(this.profile_form.isLoading=!0,this.$axios.put("/api/users/".concat(this.$auth.$state.user.username,"/"),this.profile_form).then((function(){r.profile_form.err_code=0,r.profile_form.isOK=!0,r.$auth.fetchUser(),r.$notify.success({message:"修改成功",title:"成功",timeout:1e3}),setTimeout((function(){r.profile_form.isOK=!1}),1e3)}),(function(e){r.profile_form.err_code=e.response.status})).then((function(){r.profile_form.isLoading=!1})))},change_password:function(){var r=this;this.$v.password_form.$touch(),this.$v.password_form.$invalid||(this.password_form.isLoading=!0,this.$axios.put("/api/users/".concat(this.$auth.$state.user.username,"/update_password/"),this.password_form).then((function(){r.password_form.err_code=0,r.password_form.isOK=!0,r.$notify.success({message:"修改成功",title:"成功",timeout:1e3}),setTimeout((function(){r.password_form.isOK=!1}),1e3)}),(function(e){r.password_form.err_code=e.response.status})).then((function(){r.password_form.isLoading=!1})))},submit_private:function(){this.$v.private_form.$touch(),this.$v.private_form.$invalid}}},n=o(7),component=Object(n.a)(d,(function(){var r=this,e=r.$createElement,o=r._self._c||e;return o("sui-grid",{attrs:{centered:"",stackable:""}},[o("sui-grid-row",[o("sui-grid-column",[o("sui-header",{tag:"h1"},[r._v("\n        修改资料\n      ")])],1)],1),r._v(" "),o("sui-grid-row",[o("sui-grid-column",{attrs:{width:12}},[o("sui-segment",[o("sui-form",{attrs:{method:"POST"},on:{submit:function(e){return e.preventDefault(),r.edit_profile(e)}}},[o("sui-form-fields",{attrs:{fields:2}},[o("sui-form-field",[o("label",[r._v("用户名")]),r._v(" "),o("sui-input",{attrs:{disabled:"",placeholder:"用户名"},model:{value:r.profile_form.username,callback:function(e){r.$set(r.profile_form,"username",e)},expression:"profile_form.username"}})],1),r._v(" "),o("sui-form-field",[o("label",[r._v("邮箱")]),r._v(" "),o("sui-input",{attrs:{disabled:"",placeholder:"邮箱",type:"email"},model:{value:r.profile_form.email,callback:function(e){r.$set(r.profile_form,"email",e)},expression:"profile_form.email"}})],1)],1),r._v(" "),o("sui-form-fields",{attrs:{fields:2}},[o("sui-form-field",{attrs:{error:!!r.$v.profile_form.name.$error}},[o("label",[r._v("姓名")]),r._v(" "),o("sui-input",{attrs:{disabled:r.profile_form.isLoading||r.profile_form.isOK,placeholder:"姓名",type:"text"},model:{value:r.profile_form.name,callback:function(e){r.$set(r.profile_form,"name",e)},expression:"profile_form.name"}})],1),r._v(" "),o("sui-form-field",[o("label",[r._v("性别")]),r._v(" "),o("sui-dropdown",{attrs:{disabled:r.profile_form.isLoading||r.profile_form.isOK,selection:"",placeholder:"性别",options:r.sex_options},model:{value:r.profile_form.sex,callback:function(e){r.$set(r.profile_form,"sex",e)},expression:"profile_form.sex"}})],1)],1),r._v(" "),o("sui-form-fields",{attrs:{fields:2}},[o("sui-form-field",{attrs:{error:!!r.$v.profile_form.school.$error}},[o("label",[r._v("学校")]),r._v(" "),o("sui-input",{attrs:{disabled:r.profile_form.isLoading||r.profile_form.isOK,placeholder:"学校"},model:{value:r.profile_form.school,callback:function(e){r.$set(r.profile_form,"school",e)},expression:"profile_form.school"}})],1),r._v(" "),o("sui-form-field",{attrs:{error:!!r.$v.profile_form.department.$error}},[o("label",[r._v("院系")]),r._v(" "),o("sui-input",{attrs:{disabled:r.profile_form.isLoading||r.profile_form.isOK,placeholder:"院系"},model:{value:r.profile_form.department,callback:function(e){r.$set(r.profile_form,"department",e)},expression:"profile_form.department"}})],1)],1),r._v(" "),o("sui-form-field",{attrs:{error:!!r.$v.profile_form.biography.$error}},[o("label",[r._v("自我介绍")]),r._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:r.profile_form.biography,expression:"profile_form.biography"}],attrs:{disabled:r.profile_form.isLoading||r.profile_form.isOK,rows:"4"},domProps:{value:r.profile_form.biography},on:{input:function(e){e.target.composing||r.$set(r.profile_form,"biography",e.target.value)}}})]),r._v(" "),r.$v.profile_form.name.$error||r.$v.profile_form.school.$error||r.$v.profile_form.department.$error||r.$v.profile_form.biography.$error?o("sui-form-field",[o("sui-message",{attrs:{negative:""}},[o("sui-message-list",[r.$v.profile_form.name.maxLength?r._e():o("sui-message-item",[r._v("\n                  姓名文本过长\n                ")]),r._v(" "),r.$v.profile_form.school.maxLength?r._e():o("sui-message-item",[r._v("\n                  学校文本过长\n                ")]),r._v(" "),r.$v.profile_form.department.maxLength?r._e():o("sui-message-item",[r._v("\n                  院系文本过长\n                ")]),r._v(" "),r.$v.profile_form.biography.maxLength?r._e():o("sui-message-item",[r._v("\n                  自我介绍文本过长\n                ")])],1)],1)],1):r._e(),r._v(" "),o("sui-form-field",{staticStyle:{"text-align":"right"}},[o("sui-button",{staticStyle:{width:"7em","margin-right":"0"},attrs:{disabled:r.profile_form.isLoading||r.profile_form.isOK,loading:r.profile_form.isLoading,color:r.profile_form.isOK?"green":"blue",icon:r.profile_form.isOK?"check":"none"}},[r.profile_form.isOK?r._e():o("span",[r._v("保存资料")])])],1)],1)],1),r._v(" "),o("sui-header",{tag:"h1"},[r._v("\n        修改密码\n      ")]),r._v(" "),o("sui-segment",[o("sui-form",{attrs:{method:"POST"},on:{submit:function(e){return e.preventDefault(),r.change_password(e)}}},[o("sui-form-field",{attrs:{error:!(!r.$v.password_form.old_password.$error&&!r.password_form.err_code),required:""}},[o("label",[r._v("密码")]),r._v(" "),o("sui-input",{attrs:{disabled:r.password_form.isLoading||r.password_form.isOK,placeholder:"密码",type:"password"},model:{value:r.password_form.old_password,callback:function(e){r.$set(r.password_form,"old_password",e)},expression:"password_form.old_password"}})],1),r._v(" "),o("sui-form-fields",{attrs:{fields:2}},[o("sui-form-field",{attrs:{error:!!r.$v.password_form.password.$error}},[o("label",[r._v("新密码")]),r._v(" "),o("sui-input",{attrs:{disabled:r.password_form.isLoading||r.password_form.isOK,placeholder:"新密码",type:"password"},model:{value:r.password_form.password,callback:function(e){r.$set(r.password_form,"password",e)},expression:"password_form.password"}})],1),r._v(" "),o("sui-form-field",{attrs:{error:!!r.$v.password_form.confirm_password.$error}},[o("label",[r._v("确认密码")]),r._v(" "),o("sui-input",{attrs:{disabled:r.password_form.isLoading||r.password_form.isOK,placeholder:"确认密码",type:"password"},model:{value:r.password_form.confirm_password,callback:function(e){r.$set(r.password_form,"confirm_password",e)},expression:"password_form.confirm_password"}})],1)],1),r._v(" "),r.$v.password_form.old_password.$error||r.$v.password_form.password.$error||r.$v.password_form.confirm_password.$error?o("sui-form-field",[o("sui-message",{attrs:{negative:""}},[o("sui-message-list",[r.$v.password_form.old_password.required?r._e():o("sui-message-item",[r._v("\n                  请先填写原密码\n                ")]),r._v(" "),r.$v.password_form.password.required?r._e():o("sui-message-item",[r._v("\n                  请填写新密码\n                ")]),r._v(" "),r.$v.password_form.confirm_password.required?r._e():o("sui-message-item",[r._v("\n                  请确认新密码\n                ")]),r._v(" "),r.$v.password_form.password.required&&r.$v.password_form.confirm_password.required&&!r.$v.password_form.confirm_password.sameAs?o("sui-message-item",[r._v("\n                  两次密码填写不一致\n                ")]):r._e()],1)],1)],1):r._e(),r._v(" "),o("sui-form-field",{staticStyle:{"text-align":"right"}},[o("sui-button",{staticStyle:{width:"7em","margin-right":"0"},attrs:{disabled:r.password_form.isLoading||r.password_form.isOK,loading:r.password_form.isLoading,color:r.password_form.isOK?"green":"blue",icon:r.password_form.isOK?"check":"none"}},[r.password_form.isOK?r._e():o("span",[r._v("确认修改")])])],1)],1)],1)],1),r._v(" "),o("sui-grid-column",{attrs:{width:4}},[o("sui-dimmer-dimmable",{nativeOn:{mouseenter:function(e){r.cardOneActive=!0},mouseleave:function(e){r.cardOneActive=!1}}},[o("sui-image",{attrs:{rounded:"",src:"https://cdn.v2ex.com/gravatar/"+r.$auth.$state.user.email_md5+"?s=1000&d=mm"}}),r._v(" "),o("sui-dimmer",{staticStyle:{"border-radius":".3125em"},attrs:{active:r.cardOneActive,blurring:""}},[o("sui-button",{tag:"a",attrs:{inverted:"",icon:"edit",href:"http://www.gravatar.com",target:"_blank"}},[r._v("修改头像")])],1)],1)],1)],1)],1)}),[],!1,null,"ea4aa512",null);e.default=component.exports}}]);