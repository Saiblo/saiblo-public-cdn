(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{819:function(e,t,r){var content=r(833);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(48).default)("5463f291",content,!0,{sourceMap:!1})},831:function(e,t,r){"use strict";var n=r(60),o=r(12),l=r(61),c=r(389),d=r(390),m=r(49),h=r(393),_=r(391);o(o.S+o.F*!r(392)((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,o,f,y=l(e),v="function"==typeof this?this:Array,x=arguments.length,w=x>1?arguments[1]:void 0,k=void 0!==w,S=0,C=_(y);if(k&&(w=n(w,x>2?arguments[2]:void 0,2)),null==C||v==Array&&d(C))for(r=new v(t=m(y.length));t>S;S++)h(r,S,k?w(y[S],S):y[S]);else for(f=C.call(y),r=new v;!(o=f.next()).done;S++)h(r,S,k?c(f,w,[o.value,S],!0):o.value);return r.length=S,r}})},832:function(e,t,r){"use strict";var n=r(819);r.n(n).a},833:function(e,t,r){(t=r(47)(!1)).push([e.i,"iframe[data-v-641fb81c]{width:100%;height:100%;overflow:visible;border:0}",""]),e.exports=t},863:function(e,t,r){"use strict";r.r(t);r(30),r(15),r(114),r(831),r(28),r(29);var n=r(6),o=(r(113),r(0)),l=r.n(o),c={validate:function(e){var t=e.params;return/^\d+$/.test(t.id)},data:function(){return{iframe:{height:600,fullscreen:!1},match:{game:{has_replay_player:!1}},messageObj:{},player_controller:{initted:!1,number_of_frames:0,current_frame:0,is_playing:!1,play_speed:1,timer:null},debug:{open:!1,header:"",content:[]}}},computed:{game_player:function(){return this.$refs["game-player"]},player_percent:function(){return this.player_controller.number_of_frames?Math.round(100*this.player_controller.current_frame/this.player_controller.number_of_frames):100}},watch:{"player_controller.current_frame":function(e,t){e!=t&&(e==t+1?this.playerLoadNextFrame():this.playerLoadFrame())},"player_controller.is_playing":function(e,t){var r=this;e!=t&&(this.player_controller.timer&&(clearInterval(this.player_controller.timer),this.player_controller.timer=null),e&&(this.player_controller.timer=setInterval((function(){r.playNextFrame()}),1e3/this.player_controller.play_speed)))},"player_controller.play_speed":function(e,t){var r=this;e!=t&&this.player_controller.is_playing&&(clearInterval(this.player_controller.timer),this.player_controller.timer=setInterval((function(){r.playNextFrame()}),1e3/e))}},head:function(){return{title:"对局 #".concat(this.match.id," - Saiblo")}},asyncData:function(e){return e.app.$axios.get("/api/matches/".concat(e.route.params.id,"/")).then(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n,o,l,i,c,d,m,h,_,f,y,v,x,w;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=["rgba(130, 57, 54, 0.5)","rgba(137, 190, 178, 0.5)","rgba(201, 186, 131, 0.5)","rgba(222, 211, 140, 0.5)","rgba(222, 156, 83, 0.5)"],o=Array(r.data.info.length),l=Array(r.data.info.length),i=0;i<o.length;i++)o[i]=[],l[i]=[],r.data.info[i].debug=[];for(c=JSON.parse(r.data.records),d=0;d<c.length;d++)for(m=c[d],h=0;h<m.length;h++)c[h].stderr&&r.data.info[m[h].position].debug.push(atob(c[h].stderr)),o[m[h].position].push({x:d,y:m[h].time.toFixed(2)}),l[m[h].position].push({x:d,y:(m[h].memory/1024/1024).toFixed(2)});for(_=[],f=[],y=0;y<r.data.info.length;y++)(v=r.data.info[y]).code?(_.push({label:v.user.username+" 的 "+v.code.entity+"("+v.code.version+")",data:o[y],backgroundColor:n[y],borderColor:n[y],fill:!1}),f.push({label:v.user.username+" 的 "+v.code.entity+"("+v.code.version+")",data:l[y],backgroundColor:n[y],borderColor:n[y],fill:!1})):_.push({label:v.user.username,data:o[y],backgroundColor:n[y],borderColor:n[y],fill:!1});return x={layout:{height:"400px"},responsive:!0,title:{display:!0,text:"每回合玩家用时"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"回合"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"用时(ms)"}}]}},w={layout:{height:"400px"},responsive:!0,title:{display:!0,text:"每回合AI使用内存"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"回合"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"内存(MB)"}}]}},t.next=13,e.app.$getPlayerSrc(e.app.$staticFile("/".concat(r.data.game.name,"/player.html")));case 13:return t.t0=t.sent,t.t1={src:t.t0},t.t2=r.data,t.t3={labels:Array.from(Array(c.length).keys()),datasets:_},t.t4={labels:Array.from(Array(c.length).keys()),datasets:f},t.t5=x,t.t6=w,t.abrupt("return",{iframe:t.t1,match:t.t2,chartdata:t.t3,chartdata_m:t.t4,options:t.t5,options_m:t.t6});case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(){e.error({statusCode:404,message:"没有这场对局"})}))},beforeDestroy:function(){clearInterval(this.player_controller.timer)},mounted:function(){window.addEventListener("message",this.receiveMessage,!1)},methods:{showDebug:function(e){this.debug.header=e.code.entity+" ver."+e.code.version+" 的调试信息",this.debug.content=e.debug,this.debug.open=!0},beautifyTime:function(e){return l()(e).lang("en").format("YYYY-MM-DD HH:mm:ss")},download_replay:function(e){this.$axios({url:"/api/matches/".concat(e,"/download/"),method:"GET",responseType:"blob"}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=t,r.setAttribute("download","replay.json"),document.body.appendChild(r),r.click()}))},onLoad:function(){var e=this;this.$set(this.iframe,"height",600),"评测成功"==this.match.state&&this.$axios({url:"/api/matches/".concat(this.$route.params.id,"/download/"),method:"GET",responseType:"blob"}).then((function(t){e.postMessage({message:"init_replay_player",replay_data:t.data});for(var r=[],i=0;i<e.match.info.length;i++){var n=e.match.info[i];n.code?r.push(n.user.username+" 的 "+n.code.entity+"("+n.code.version+")"):r.push(n.user.username)}e.postMessage({message:"load_players",players:r})}))},postMessage:function(data){this.game_player.contentWindow.postMessage(data,"*")},receiveMessage:function(e){switch(e.data.message){case"init_successfully":"评测成功"==this.match.state&&(this.player_controller.number_of_frames=e.data.number_of_frames,this.player_controller.initted=!0);break;case"resized":this.$set(this.iframe,"height",e.data.height+30)}},playerLoadFrame:function(){this.postMessage({message:"load_frame",index:this.player_controller.current_frame})},playerLoadNextFrame:function(){this.postMessage({message:"load_next_frame"})},previousFrame:function(){this.player_controller.current_frame&&this.player_controller.current_frame--,this.player_controller.is_playing=!1},nextFrame:function(){this.player_controller.current_frame<this.player_controller.number_of_frames&&this.player_controller.current_frame++,this.player_controller.is_playing=!1},playNextFrame:function(){this.player_controller.current_frame<this.player_controller.number_of_frames?this.player_controller.current_frame++:this.player_controller.is_playing=!1},changeSpeed:function(){this.player_controller.play_speed<4?this.player_controller.play_speed*=2:this.player_controller.play_speed=1},resetPlayer:function(){this.player_controller.current_frame=0,this.player_controller.is_playing=!1},getColor:function(e){switch(e){case"OK":return"yellowgreen";case"TLE":return"goldenrod";case"MLE":return"steelblue";case"RE":return"mediumpurple"}},getState:function(e){switch(e){case"OK":return"OK";case"TLE":return"Time Limit Exceed";case"MLE":return"Memory Limit Exceed";case"RE":return"Runtime Error"}}}},d=(r(832),r(7)),component=Object(d.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("sui-breadcrumb",[e.match.contest&&"{}"!==JSON.stringify(e.match.contest)?r("span",[r("sui-breadcrumb-section",[r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/group/"+e.match.contest.group.id+"/"}},[e._v(e._s(e.match.contest.group.name))])],1),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/group/"+e.match.contest.group.id+"/contest/"+e.match.contest.id}},[e._v(e._s(e.match.contest.name))])],1):r("span",[r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/games"}},[e._v("游戏")]),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/game/"+e.match.game.id}},[e._v("\n        "+e._s(e.match.game.alias)+"\n      ")])],1),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{attrs:{active:""}},[e._v("对局")])],1),e._v(" "),r("sui-grid",{attrs:{stackable:""}},[r("sui-grid-row",[r("sui-grid-column",[r("sui-header",{tag:"h1"},[e._v("对局 #"+e._s(e.match.id))])],1)],1),e._v(" "),r("sui-grid-row",[r("sui-grid-column",{attrs:{width:12}},[r("sui-segment",[r("div",{staticClass:"f sb ce",staticStyle:{"margin-bottom":"20px"}},[r("div",[r("span",{staticStyle:{color:"grey"}},[e._v("\n                对局时间："+e._s(e.beautifyTime(e.match.create_time))+" 当前状态：\n              ")]),e._v(" "),r("span",{style:"color: "+("准备中"==e.match.state?"grey":"评测中"==e.match.state?"orange":"评测失败"==e.match.state?"red":"green")},[e._v(e._s(e.match.state))])]),e._v(" "),r("sui-button",{attrs:{size:"mini",color:"blue",basic:""},nativeOn:{click:function(t){return e.download_replay(e.match.id)}}},[e._v("下载回放")])],1),e._v(" "),e.match.game.has_replay_player?r("iframe",{ref:"game-player",style:e.iframe.fullscreen?"position: fixed; top: 0; left: 0; z-index: 10000; width: 100%; height: 100%;":"width: 100%; height: "+e.iframe.height+"px;",attrs:{src:e.iframe.src,scrolling:"auto"},on:{load:function(t){return e.onLoad()}}}):r("div",[r("sui-dimmer-dimmable",[r("sui-image",{attrs:{src:e.$staticFile("/"+e.match.game.name+"/cover.png")}}),e._v(" "),r("sui-dimmer",{attrs:{active:""}},[r("sui-container",{staticStyle:{"font-size":"2em","font-weight":"thick"},attrs:{"text-align":"center"}},[e._v("该游戏无网页版播放器，请下载播放器并离线播放")])],1)],1)],1),e._v(" "),("评测成功"==e.match.state&&e.player_controller.initted,r("div",{class:e.iframe.fullscreen?"f cr ce":"f c ce",style:e.iframe.fullscreen?"position: fixed; bottom: 0; left: 0; margin: auto; z-index: 10001; width: 100%;":""},[r("sui-progress",{staticStyle:{"margin-bottom":"0",width:"100%"},attrs:{state:"active",color:"violet",percent:e.player_percent,progress:""}}),e._v(" "),r("div",{staticClass:"ui grey icon buttons"},[r("div",{staticClass:"ui button",on:{click:function(t){return t.preventDefault(),e.previousFrame()}}},[r("sui-icon",{attrs:{name:"chevron left"}})],1),e._v(" "),r("div",{staticClass:"ui button",on:{click:function(t){return t.preventDefault(),e.nextFrame()}}},[r("sui-icon",{attrs:{name:"chevron right"}})],1),e._v(" "),r("div",{staticClass:"ui button",on:{click:function(t){t.preventDefault(),e.player_controller.is_playing=!e.player_controller.is_playing}}},[r("sui-icon",{attrs:{name:e.player_controller.is_playing?"stop":"play"}})],1),e._v(" "),r("div",{staticClass:"ui button",staticStyle:{padding:"11px"},on:{click:function(t){return t.preventDefault(),e.changeSpeed()}}},[e._v("\n                "+e._s(e.player_controller.play_speed)+"X\n              ")]),e._v(" "),r("div",{staticClass:"ui button",on:{click:function(t){return t.preventDefault(),e.resetPlayer()}}},[r("sui-icon",{attrs:{name:"undo"}})],1),e._v(" "),r("sui-popup",{attrs:{content:e.iframe.fullscreen?"退出全屏":"全屏模式",inverted:""}},[r("div",{staticClass:"ui button",attrs:{slot:"trigger"},on:{click:function(t){return t.preventDefault(),e.$set(e.iframe,"fullscreen",!e.iframe.fullscreen)}},slot:"trigger"},[r("sui-icon",{attrs:{name:e.iframe.fullscreen?"compress":"expand"}})],1)])],1)],1))]),e._v(" "),r("sui-segment",[r("time-chart",{attrs:{height:200,chartdata:e.chartdata,options:e.options}})],1),e._v(" "),r("sui-segment",[r("time-chart",{attrs:{height:200,chartdata:e.chartdata_m,options:e.options_m}})],1)],1),e._v(" "),r("sui-grid-column",{attrs:{width:4}},[r("sui-table",[r("sui-table-body",e._l(e.match.info,(function(t,n){return r("sui-table-row",{key:n},[r("sui-table-cell",{style:"position: relative; padding-top: 20px; padding-bottom: 20px; background-color: "+(t.code?"unset;":"aliceblue;")},[r("div",{style:"position: absolute; top: -7px; right: -7px; background-color: "+e.getColor(t.end_state)+"; padding: 1px 3px; font-size: 1rem; color: white; border-radius: 0.5rem; padding: 0.2rem 0.4rem;"},[r("b",[e._v(e._s(t.end_state))])]),e._v(" "),r("sui-image",{staticStyle:{float:"left","margin-right":"1em"},attrs:{size:"mini",src:"https://cdn.v2ex.com/gravatar/"+t.user.email_md5+"?s=1000&d=mm"}}),e._v(" "),r("div",[r("b",{staticStyle:{"font-size":"large"}},[r("nuxt-link",{attrs:{to:"/user/"+t.user.username}},[e._v("\n                      "+e._s(t.user.username)+"\n                    ")])],1)]),e._v(" "),r("div",{staticStyle:{color:"grey","font-size":"small"}},[e._v("\n                  "+e._s(t.user.name)+"\n                  "+e._s(t.user.school)+"\n                  "+e._s(t.user.department)+"\n                ")]),e._v(" "),r("div",[e._v("\n                  排名："+e._s(t.rank)+"\n                  "),r("span",{staticStyle:{float:"right"}},[e._v(e._s(t.score)+"pts.")])]),e._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[t.code?r("div",[r("sui-label",{attrs:{color:"blue"}},[e._v("\n                      "+e._s(t.code.entity)+"\n                      "),r("sui-label-detail",[e._v("ver."+e._s(t.code.version))])],1),e._v(" "),t.user.username==e.$auth.$state.user.username?r("sui-popup",{attrs:{content:"点击查看程序输出的调试信息",inverted:""}},[r("sui-label",{tag:"a",attrs:{slot:"trigger",color:"purple"},on:{click:function(r){return e.showDebug(t)}},slot:"trigger"},[r("sui-icon",{staticStyle:{"margin-right":"0"},attrs:{name:"bug"}})],1)],1):e._e()],1):r("sui-label",{attrs:{color:"olive",size:"mini"}},[e._v("人类玩家")])],1)],1)],1)})),1)],1)],1)],1)],1),e._v(" "),r("sui-modal",{staticStyle:{"z-index":"10002"},model:{value:e.debug.open,callback:function(t){e.$set(e.debug,"open",t)},expression:"debug.open"}},[r("sui-modal-header",[e._v(e._s(e.debug.header))]),e._v(" "),r("sui-modal-content",{staticStyle:{padding:"0 !important","border-radius":"0"},attrs:{scrolling:""}},[r("sui-table",{staticStyle:{background:"rgb(40, 44, 52)",color:"#abb2bf",padding:"10px","border-radius":"0","font-size":"large","font-family":"'Ubuntu Mono',Consolas,monospace,sans-serif"},attrs:{unstackable:""}},[r("sui-table-body",e._l(e.debug.content,(function(t,n){return r("sui-table-row",{key:n},[r("sui-table-cell",{staticStyle:{padding:"3px 10px 3px 0","text-align":"right",border:"0","border-right":"1px solid #f5f6f7"},attrs:{collapsing:""}},[r("b",[e._v(e._s(n))])]),e._v(" "),r("sui-table-cell",{staticStyle:{padding:"3px 0 3px 10px",border:"0"}},[r("b",[e._v(e._s(t))])])],1)})),1)],1)],1)],1)],1)}),[],!1,null,"641fb81c",null);t.default=component.exports}}]);