(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{819:function(e,t,r){var content=r(833);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(47).default)("6319cc39",content,!0,{sourceMap:!1})},831:function(e,t,r){"use strict";var n=r(59),o=r(12),l=r(60),c=r(389),m=r(390),d=r(48),h=r(393),_=r(391);o(o.S+o.F*!r(392)((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,o,f,y=l(e),v="function"==typeof this?this:Array,x=arguments.length,w=x>1?arguments[1]:void 0,k=void 0!==w,S=0,A=_(y);if(k&&(w=n(w,x>2?arguments[2]:void 0,2)),null==A||v==Array&&m(A))for(r=new v(t=d(y.length));t>S;S++)h(r,S,k?w(y[S],S):y[S]);else for(f=A.call(y),r=new v;!(o=f.next()).done;S++)h(r,S,k?c(f,w,[o.value,S],!0):o.value);return r.length=S,r}})},832:function(e,t,r){"use strict";var n=r(819);r.n(n).a},833:function(e,t,r){(t=r(46)(!1)).push([e.i,"iframe[data-v-fce60c24]{width:100%;height:100%;overflow:visible;border:0}",""]),e.exports=t},861:function(e,t,r){"use strict";r.r(t);r(113),r(29),r(15),r(114),r(831);var n=r(0),o=r.n(n),l={validate:function(e){var t=e.params;return/^\d+$/.test(t.id)},data:function(){return{iframe:{height:200,src:"/",fullscreen:!1},match:{game:{has_replay_player:!1}},messageObj:{},player_controller:{initted:!1,number_of_frames:0,current_frame:0,is_playing:!1,play_speed:1,timer:null}}},computed:{game_player:function(){return this.$refs["game-player"]},player_percent:function(){return this.player_controller.number_of_frames?Math.round(100*this.player_controller.current_frame/this.player_controller.number_of_frames):100}},watch:{"player_controller.current_frame":function(e,t){e!=t&&(e==t+1?this.playerLoadNextFrame():this.playerLoadFrame())},"player_controller.is_playing":function(e,t){var r=this;e!=t&&(this.player_controller.timer&&(clearInterval(this.player_controller.timer),this.player_controller.timer=null),e&&(this.player_controller.timer=setInterval((function(){r.playNextFrame()}),1e3/this.player_controller.play_speed)))},"player_controller.play_speed":function(e,t){var r=this;e!=t&&this.player_controller.is_playing&&(clearInterval(this.player_controller.timer),this.player_controller.timer=setInterval((function(){r.playNextFrame()}),1e3/e))}},asyncData:function(e){return e.app.$axios.get("/api/matches/".concat(e.route.params.id,"/")).then((function(e){console.log(e.data);for(var t=["rgba(130, 57, 54, 0.5)","rgba(137, 190, 178, 0.5)","rgba(201, 186, 131, 0.5)","rgba(222, 211, 140, 0.5)","rgba(222, 156, 83, 0.5)"],r=Array(e.data.info.length),n=Array(e.data.info.length),i=0;i<r.length;i++)r[i]=[],n[i]=[];for(var o=JSON.parse(e.data.records),l=0;l<o.length;l++)for(var c=o[l],m=0;m<c.length;m++)r[c[m].position].push({x:l,y:c[m].time.toFixed(2)}),n[c[m].position].push({x:l,y:(c[m].memory/1024/1024).toFixed(2)});for(var d=[],h=[],_=0;_<e.data.info.length;_++){var f=e.data.info[_];f.code?(d.push({label:f.user.username+" 的 "+f.code.entity+"("+f.code.version+")",data:r[_],backgroundColor:t[_],borderColor:t[_],fill:!1}),h.push({label:f.user.username+" 的 "+f.code.entity+"("+f.code.version+")",data:n[_],backgroundColor:t[_],borderColor:t[_],fill:!1})):d.push({label:f.user.username,data:r[_],backgroundColor:t[_],borderColor:t[_],fill:!1})}return{match:e.data,chartdata:{labels:Array.from(Array(o.length).keys()),datasets:d},chartdata_m:{labels:Array.from(Array(o.length).keys()),datasets:h},options:{layout:{height:"400px"},responsive:!0,title:{display:!0,text:"每回合玩家用时"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"回合"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"用时(ms)"}}]}},options_m:{layout:{height:"400px"},responsive:!0,title:{display:!0,text:"每回合AI使用内存"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"回合"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"内存(MB)"}}]}}}}),(function(){e.error({statusCode:404,message:"没有这场对局"})}))},beforeDestroy:function(){clearInterval(this.player_controller.timer)},mounted:function(){window.addEventListener("message",this.receiveMessage,!1),console.log(window.chartColors)},methods:{beautifyTime:function(e){return o()(e).lang("en").format("YYYY-MM-DD HH:mm:ss")},download_replay:function(e){this.$axios({url:"/api/matches/".concat(e,"/download/"),method:"GET",responseType:"blob"}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=t,r.setAttribute("download","replay.json"),document.body.appendChild(r),r.click()}))},onLoad:function(){var e=this;this.iframe.height=this.game_player.contentDocument.body.scrollHeight+30,"评测成功"==this.match.state&&this.$axios({url:"/api/matches/".concat(this.$route.params.id,"/download/"),method:"GET",responseType:"blob"}).then((function(t){e.postMessage({message:"init_replay_player",replay_data:t.data});for(var r=[],i=0;i<e.match.info.length;i++){var n=e.match.info[i];n.code?r.push(n.user.username+" 的 "+n.code.entity+"("+n.code.version+")"):r.push(n.user.username)}e.postMessage({message:"load_players",players:r})}))},postMessage:function(data){this.game_player.contentWindow.postMessage(data,this.iframe.src)},receiveMessage:function(e){switch(e.data.message){case"init_successfully":"评测成功"==this.match.state&&(this.player_controller.number_of_frames=e.data.number_of_frames,this.player_controller.initted=!0);break;case"resized":this.iframe.height=this.game_player.contentDocument.body.scrollHeight+30}},playerLoadFrame:function(){this.postMessage({message:"load_frame",index:this.player_controller.current_frame})},playerLoadNextFrame:function(){this.postMessage({message:"load_next_frame"})},previousFrame:function(){this.player_controller.current_frame&&this.player_controller.current_frame--,this.player_controller.is_playing=!1},nextFrame:function(){this.player_controller.current_frame<this.player_controller.number_of_frames&&this.player_controller.current_frame++,this.player_controller.is_playing=!1},playNextFrame:function(){this.player_controller.current_frame<this.player_controller.number_of_frames?this.player_controller.current_frame++:this.player_controller.is_playing=!1},changeSpeed:function(){this.player_controller.play_speed<4?this.player_controller.play_speed*=2:this.player_controller.play_speed=1},resetPlayer:function(){this.player_controller.current_frame=0,this.player_controller.is_playing=!1}}},c=(r(832),r(7)),component=Object(c.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("sui-breadcrumb",[e.match.contest&&"{}"!==JSON.stringify(e.match.contest)?r("span",[r("sui-breadcrumb-section",[r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/group/"+e.match.contest.group.id+"/"}},[e._v(e._s(e.match.contest.group.name))])],1),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/group/"+e.match.contest.group.id+"/contest/"+e.match.contest.id}},[e._v(e._s(e.match.contest.name))])],1):r("span",[r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/games"}},[e._v("游戏")]),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{tag:"nuxt-link",attrs:{to:"/game/"+e.match.game.id}},[e._v("\n        "+e._s(e.match.game.alias)+"\n      ")])],1),e._v(" "),r("sui-breadcrumb-divider",{attrs:{icon:"right chevron"}}),e._v(" "),r("sui-breadcrumb-section",{attrs:{active:""}},[e._v("对局")])],1),e._v(" "),r("sui-grid",{attrs:{stackable:""}},[r("sui-grid-row",[r("sui-grid-column",[r("sui-header",{tag:"h1"},[e._v("对局 #"+e._s(e.match.id))])],1)],1),e._v(" "),r("sui-grid-row",[r("sui-grid-column",{attrs:{width:12}},[r("sui-segment",[r("div",{staticClass:"f sb ce",staticStyle:{"margin-bottom":"20px"}},[r("div",[r("span",{staticStyle:{color:"grey"}},[e._v("\n                对局时间："+e._s(e.beautifyTime(e.match.create_time))+" 当前状态：\n              ")]),e._v(" "),r("span",{style:"color: "+("准备中"==e.match.state?"grey":"评测中"==e.match.state?"orange":"评测失败"==e.match.state?"red":"green")},[e._v(e._s(e.match.state))])]),e._v(" "),r("sui-button",{attrs:{size:"mini",color:"blue",basic:""},nativeOn:{click:function(t){return e.download_replay(e.match.id)}}},[e._v("下载回放")])],1),e._v(" "),e.match.game.has_replay_player?r("sui-button",{staticStyle:{position:"fixed",left:"0","z-index":"10001"},on:{click:function(t){t.preventDefault(),e.iframe.fullscreen=!e.iframe.fullscreen}}},[e.iframe.fullscreen?r("span",[e._v("退出全屏")]):r("span",[e._v("全屏模式")])]):e._e(),e._v(" "),e.match.game.has_replay_player?r("iframe",{ref:"game-player",style:e.iframe.fullscreen?"position: fixed; top: 0; left: 0; z-index: 10000; width: 100%; height: 100%;":"width: 100%; height: "+e.iframe.height+"px;",attrs:{src:e.$staticFile("/"+e.match.game.name+"/player.html"),scrolling:"auto"},on:{load:function(t){return e.onLoad()}}}):r("div",[r("sui-dimmer-dimmable",[r("sui-image",{attrs:{src:e.$staticFile("/"+e.match.game.name+"/cover.png")}}),e._v(" "),r("sui-dimmer",{attrs:{active:""}},[r("sui-container",{staticStyle:{"font-size":"2em","font-weight":"thick"},attrs:{"text-align":"center"}},[e._v("该游戏无网页版播放器，请下载播放器并离线播放")])],1)],1)],1),e._v(" "),"评测成功"==e.match.state&&e.player_controller.initted?r("div",{class:e.iframe.fullscreen?"f cr ce":"f c ce",style:e.iframe.fullscreen?"position: fixed; bottom: 0; left: 0; margin: auto; z-index: 10001; width: 100%;":""},[r("sui-progress",{staticStyle:{"margin-bottom":"0",width:"100%"},attrs:{state:"active",color:"violet",percent:e.player_percent,progress:""}}),e._v(" "),r("sui-button-group",{attrs:{color:"grey"}},[r("sui-button",{attrs:{icon:"chevron left"},on:{click:function(t){return t.preventDefault(),e.previousFrame()}}}),e._v(" "),r("sui-button",{attrs:{icon:"chevron right"},on:{click:function(t){return t.preventDefault(),e.nextFrame()}}}),e._v(" "),r("sui-button",{attrs:{icon:e.player_controller.is_playing?"stop":"play"},on:{click:function(t){t.preventDefault(),e.player_controller.is_playing=!e.player_controller.is_playing}}}),e._v(" "),r("sui-button",{staticStyle:{padding:"11px"},on:{click:function(t){return t.preventDefault(),e.changeSpeed()}}},[e._v(e._s(e.player_controller.play_speed)+"X")]),e._v(" "),r("sui-button",{attrs:{icon:"undo"},on:{click:function(t){return t.preventDefault(),e.resetPlayer()}}})],1)],1):e._e()],1),e._v(" "),r("sui-segment",[r("time-chart",{attrs:{height:200,chartdata:e.chartdata,options:e.options}})],1),e._v(" "),r("sui-segment",[r("time-chart",{attrs:{height:200,chartdata:e.chartdata_m,options:e.options_m}})],1)],1),e._v(" "),r("sui-grid-column",{attrs:{width:4}},[r("sui-table",[r("sui-table-body",e._l(e.match.info,(function(t,n){return r("sui-table-row",{key:n},[r("sui-table-cell",{style:"background-color: "+(t.code?"unset;":"aliceblue;")},[r("sui-image",{staticStyle:{float:"left","margin-right":"1em"},attrs:{size:"mini",src:"https://cdn.v2ex.com/gravatar/"+t.user.email_md5+"?s=1000&d=mm"}}),e._v(" "),r("div",[r("b",{staticStyle:{"font-size":"large"}},[r("nuxt-link",{attrs:{to:"/user/"+t.user.username}},[e._v("\n                      "+e._s(t.user.username)+"\n                    ")])],1)]),e._v(" "),r("div",{staticStyle:{color:"grey","font-size":"small"}},[e._v("\n                  "+e._s(t.user.name)+"\n                  "+e._s(t.user.school)+"\n                  "+e._s(t.user.department)+"\n                ")]),e._v(" "),r("div",[e._v("\n                  排名："+e._s(t.rank)+"\n                  "),r("span",{staticStyle:{float:"right"}},[e._v(e._s(t.score)+"pts.")])]),e._v(" "),r("div",{staticStyle:{"text-align":"center"}},[t.code?r("span",[e._v("\n                    AI：\n                    "),r("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.play()}}},[e._v("\n                      "+e._s(t.code.entity)+"\n                      "),r("span",{staticStyle:{"font-size":"xx-small"}},[e._v(e._s(t.code.version))])])]):r("span",[e._v("人类玩家")])])],1)],1)})),1)],1)],1)],1)],1),e._v(" "),r("sui-modal")],1)}),[],!1,null,"fce60c24",null);t.default=component.exports}}]);