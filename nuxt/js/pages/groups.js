(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{878:function(t,e,o){"use strict";o.r(e);o(19),o(17);var r=o(22),n={auth:!1,head:function(){return{title:"小组列表 - Saiblo"}},data:function(){return{show_modal:!1,group_form:{name:"",introduction:"",reason:"",manager:this.$auth.$state.loggedIn?this.$auth.$state.user.id:-1},isLoading:!1,isOK:!1,err_msg:"",err_code:0,loading_err_code:0,groups:[],origin_groups:[],keyWord:""}},validations:{group_form:{name:{required:r.required,maxLength:Object(r.maxLength)(30)},introduction:{required:r.required},reason:{required:r.required}}},watch:{"group_form.name":function(){this.err_code=0},"group_form.introduction":function(){this.err_code=0},"group_form.reason":function(){this.err_code=0},keyWord:function(){this.searchKeyWord()}},asyncData:function(t){return t.$axios.get("/api/groups/").then((function(t){var e=t.data;return e.forEach((function(t){null==t.size&&(t.size="N/A")})),{groups:e}}))},methods:{truncate:function(t,e){return t.length>e?t.substring(0,e)+"...":t},apply:function(t){var e=this;"idle"==t.relation?(this.$axios.get("/api/users/".concat(this.$auth.$state.user.username,"/applications/")).then((function(){})),this.$axios.post("/api/groups/".concat(t.id,"/applications/"),{message:"temp"}).then((function(){e.$notify.success({title:"成功",message:"已申请入组",timeout:1e3}),e.$axios.get("/api/groups/".concat(t.id,"/")).then((function(e){t.relation=e.data.relation,"joined"==t.relation&&(t.size+=1)}))}),(function(){}))):this.$axios.get("/api/users/".concat(this.$auth.$state.user.username,"/applications/")).then((function(o){o.data.forEach((function(o){o.group==t.id&&e.$axios.put("/api/users/".concat(e.$auth.$state.user.username,"/applications/").concat(o.id,"/"),{message:"fuck"}).then((function(){e.$notify.success({title:"成功",message:"已重新申请",timeout:1e3}),e.$axios.get("/api/groups/".concat(t.id,"/")).then((function(e){t.relation=e.data.relation,"joined"==t.relation&&(t.size+=1)}))}))}))}),(function(){}))},cancel:function(t){var e=this;this.$axios.get("/api/users/".concat(this.$auth.$state.user.username,"/applications/")).then((function(o){o.data.forEach((function(o){o.group==t.id&&e.$axios.delete("/api/users/".concat(e.$auth.$state.user.username,"/applications/").concat(o.id,"/")).then((function(){e.$notify.success({title:"成功",message:"已取消申请",timeout:1e3}),t.relation="idle"}))}))}),(function(){}))},quit:function(t){var e=this;this.$axios.delete("/api/groups/".concat(t.id,"/users/").concat(this.$auth.$state.user.username,"/")).then((function(){e.$notify.success({title:"成功",message:"已退出小组",timeout:1e3}),t.relation="idle",t.size-=1,t.managers=t.managers.filter((function(t){return t!=e.$auth.$state.user.username}))}))},show:function(){this.isOK&&(this.isOK=!1,this.isLoading=!1),this.show_modal=!0},create_groups:function(){var t=this;this.$v.$touch(),this.$v.$invalid||(this.isLoading=!0,this.$axios.post("/api/groups/",this.group_form).then((function(){t.err_code=0,t.isOK=!0,t.$notify.success({message:"成功递交小组申请",title:"成功",timeout:1e3}),t.$axios.get("/api/groups/").then((function(e){t.groups=e.data})),t.show_modal=!1,setTimeout((function(){t.isOK=!1}),1e3)}),(function(e){t.err_code=e.response.status})).then((function(){t.isLoading=!1})))},keyWordFilter:function(t){return t.name.indexOf(this.keyWord)>=0},searchKeyWord:function(){0==this.origin_groups.length&&(this.origin_groups=this.groups),this.groups=this.origin_groups.filter(this.keyWordFilter)},group_permission:function(t){return t.auto_pass?"任何人均可加入":t.accept_application?"需管理员通过申请":"只能管理员邀请"}}},c=o(7),component=Object(c.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("sui-grid",[o("sui-grid-row",[o("sui-grid-column",[o("div",{staticClass:"wide-screen"},[o("div",{staticClass:"f sb w",staticStyle:{"margin-top":"-3.2px"}},[o("div",{staticClass:"f ce w"},[o("sui-header",{tag:"h1",staticClass:"ib",staticStyle:{"margin-bottom":"0","margin-right":"1em"}},[t._v("小组列表")]),t._v(" "),o("sui-input",{staticStyle:{width:"31em"},attrs:{icon:"search",type:"search",placeholder:"搜索小组名","icon-position":"right"},model:{value:t.keyWord,callback:function(e){t.keyWord=e},expression:"keyWord"}})],1),t._v(" "),o("div",{staticClass:"f rr g"},[t.$auth.$state.loggedIn?o("sui-button",{staticStyle:{"margin-right":"0"},attrs:{primary:"",icon:"add","icon-position":"right"},on:{click:function(e){return e.preventDefault(),t.show(e)}}},[t._v("创建小组")]):t._e()],1)])]),t._v(" "),o("div",{staticClass:"narrow-screen"},[o("div",{staticClass:"f c"},[o("div",{staticClass:"f sb"},[o("sui-header",{tag:"h1",staticClass:"ib",staticStyle:{"margin-bottom":"0"}},[t._v("小组列表")]),t._v(" "),t.$auth.$state.loggedIn?o("sui-button",{staticStyle:{"margin-right":"0"},attrs:{primary:"",icon:"add","icon-position":"right",size:"small"},on:{click:function(e){return e.preventDefault(),t.show(e)}}},[t._v("创建小组")]):t._e()],1)]),t._v(" "),o("sui-input",{staticStyle:{width:"100%","margin-top":"1em"},attrs:{icon:"search",type:"search",placeholder:"搜索小组名","icon-position":"right"},model:{value:t.keyWord,callback:function(e){t.keyWord=e},expression:"keyWord"}})],1)])],1),t._v(" "),0==t.groups.length?o("sui-grid-row",[o("sui-grid-column",[o("sui-message",{attrs:{icon:"exclamation",header:"没有找到小组",content:"请创建小组或更改搜索关键词",info:""}})],1)],1):t._e(),t._v(" "),o("sui-grid-row",[o("sui-grid-column",[o("div",{staticClass:"f w",staticStyle:{margin:"-1em"}},[t._l(t.groups,(function(e){return o("sui-card",{key:e.id,staticClass:"g",staticStyle:{margin:"1em",width:"280px"}},[o("sui-card-content",[o("sui-card-header",{staticStyle:{"text-align":"center"}},[o("nuxt-link",{attrs:{to:"/group/"+e.id}},[t._v(t._s(e.name))])],1),t._v(" "),o("br"),t._v(" "),o("sui-card-meta",[o("sui-list",[o("sui-list-item",[o("sui-list-icon",{attrs:{name:"user plus"}}),t._v(" "),o("sui-list-content",[o("sui-list-header",[t._v("管理员："),o("nuxt-link",{staticStyle:{color:"orange"},attrs:{to:"/user/"+e.creator}},[t._v(t._s(e.creator))]),t._l(e.managers,(function(e,r){return[o("nuxt-link",{key:r,attrs:{to:"/user/"+e}},[t._v(t._s(e))])]}))],2)],1)],1),t._v(" "),o("sui-list-item",[o("sui-list-icon",{attrs:{name:"users"}}),t._v(" "),o("sui-list-content",[o("sui-list-header",[t._v("成员数："+t._s(e.size))])],1)],1),t._v(" "),o("sui-list-item",[o("sui-list-icon",{staticStyle:{"padding-left":"2.8px"},attrs:{name:"check circle"}}),t._v(" "),o("sui-list-content",[o("sui-list-header",[t._v("加入权限："+t._s(t.group_permission(e)))])],1)],1)],1)],1),t._v(" "),o("sui-divider"),t._v(" "),o("sui-card-description",[o("sui-list",[o("sui-list-item",[o("sui-list-icon",{staticStyle:{"padding-right":"5.75px"},attrs:{name:"comment"}}),t._v(" "),o("sui-list-content",[t._v("\n                                            "+t._s(t.truncate(e.introduction,100))+"\n                                        ")])],1)],1)],1)],1),t._v(" "),o("sui-button",{directives:[{name:"show",rawName:"v-show",value:"idle"==e.relation,expression:"group.relation == 'idle'"}],attrs:{attached:"bottom",icon:"add","icon-position":"left"},on:{click:function(o){return o.preventDefault(),t.apply(e)}}},[t._v("申请加入")]),t._v(" "),o("sui-button",{directives:[{name:"show",rawName:"v-show",value:"rejected"==e.relation,expression:"group.relation == 'rejected'"}],attrs:{animated:"",color:"red"},on:{click:function(o){return o.preventDefault(),t.apply(e)}}},[o("sui-button-content",{attrs:{visible:""}},[o("sui-icon",{attrs:{name:"x"}}),t._v("已被拒绝 ")],1),t._v(" "),o("sui-button-content",{attrs:{hidden:""}},[o("sui-icon",{attrs:{name:"add"}}),t._v("重新申请 ")],1)],1),t._v(" "),o("sui-button",{directives:[{name:"show",rawName:"v-show",value:"applying"==e.relation,expression:"group.relation == 'applying'"}],attrs:{attached:"bottom",animated:"",color:"yellow"},on:{click:function(o){return o.preventDefault(),t.cancel(e)}}},[o("sui-button-content",{attrs:{visible:""}},[o("sui-icon",{attrs:{name:"circle"}}),t._v("正在申请 ")],1),t._v(" "),o("sui-button-content",{attrs:{hidden:""}},[o("sui-icon",{attrs:{name:"left angle"}}),t._v("取消申请 ")],1)],1),t._v(" "),"joined"==e.relation||"managing"==e.relation?o("div",{staticClass:"bg ba"},[o("confirm-button",{attrs:{button:{color:"green",animated:!0},message:"确认要退出 "+e.name+" 小组吗？"},on:{confirmed:function(o){return t.quit(e)}}},[o("sui-button-content",{attrs:{visible:""}},[o("sui-icon",{attrs:{name:"check"}}),t._v("已经加入 ")],1),t._v(" "),o("sui-button-content",{attrs:{hidden:""}},[o("sui-icon",{attrs:{name:"left angle"}}),t._v("退出小组 ")],1)],1)],1):t._e(),t._v(" "),o("sui-button",{directives:[{name:"show",rawName:"v-show",value:"created"==e.relation,expression:"group.relation == 'created'"}],attrs:{color:"purple",animated:""},on:{click:function(o){return o.preventDefault(),t.$router.push("/group/"+e.id+"/manage")}}},[o("sui-button-content",{attrs:{visible:""}},[o("sui-icon",{attrs:{name:"user outline"}}),t._v("创建者 ")],1),t._v(" "),o("sui-button-content",{attrs:{hidden:""}},[o("sui-icon",{attrs:{name:"external alternate"}}),t._v("管理小组 ")],1)],1)],1)})),t._v(" "),o("div",{staticClass:"g",staticStyle:{width:"calc(2em + 280px)"}}),t._v(" "),o("div",{staticClass:"g",staticStyle:{width:"calc(2em + 280px)"}})],2)])],1)],1),t._v(" "),o("sui-modal",{attrs:{size:"tiny"},model:{value:t.show_modal,callback:function(e){t.show_modal=e},expression:"show_modal"}},[o("sui-modal-header",[t._v("创建小组")]),t._v(" "),o("sui-modal-content",[o("sui-message",{attrs:{info:""}},[o("p",[t._v("小组是以教学或举办比赛为目的的组织单位，请在申请前明确自己的用途，如开课、举办人工智能对抗比赛等。")])]),t._v(" "),o("sui-form",[o("sui-form-field",{attrs:{error:!(!t.$v.group_form.name.$error&&!t.err_code)}},[o("label",[t._v("名称")]),t._v(" "),o("sui-input",{attrs:{type:"text",disabled:t.isLoading},model:{value:t.group_form.name,callback:function(e){t.$set(t.group_form,"name",e)},expression:"group_form.name"}})],1),t._v(" "),o("sui-form-field",{attrs:{error:!(!t.$v.group_form.introduction.$error&&!t.err_code)}},[o("label",[t._v("简介")]),t._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.group_form.introduction,expression:"group_form.introduction"}],attrs:{type:"text",rows:"7",disabled:t.isLoading},domProps:{value:t.group_form.introduction},on:{input:function(e){e.target.composing||t.$set(t.group_form,"introduction",e.target.value)}}})]),t._v(" "),o("sui-form-field",{attrs:{error:!(!t.$v.group_form.reason.$error&&!t.err_code)}},[o("label",[t._v("申请理由")]),t._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.group_form.reason,expression:"group_form.reason"}],attrs:{type:"text",rows:"7",disabled:t.isLoading},domProps:{value:t.group_form.reason},on:{input:function(e){e.target.composing||t.$set(t.group_form,"reason",e.target.value)}}})]),t._v(" "),t.$v.group_form.name.$error||t.$v.group_form.introduction.$error||t.$v.group_form.reason.$error?o("sui-form-field",[o("sui-message",{attrs:{negative:""}},[o("sui-message-list",[t.$v.group_form.name.required?t._e():o("sui-message-item",[t._v("小组名不能为空")]),t._v(" "),t.$v.group_form.name.maxLength?t._e():o("sui-message-item",[t._v("小组名过长")]),t._v(" "),t.$v.group_form.introduction.required?t._e():o("sui-message-item",[t._v("简介不能为空")]),t._v(" "),t.$v.group_form.reason.required?t._e():o("sui-message-item",[t._v("理由不能为空")])],1)],1)],1):t._e(),t._v(" "),o("sui-form-field",[o("sui-button",{staticStyle:{width:"5em"},attrs:{floated:"right",disabled:t.isLoading||t.isOK,isloading:t.isLoading,icon:t.isOK?"check":"none",color:t.isOK?"green":"blue"},on:{click:function(e){return e.preventDefault(),t.create_groups(e)}}},[t.isOK?t._e():o("span",[t._v("提交")])])],1),t._v(" "),o("sui-form-field")],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);