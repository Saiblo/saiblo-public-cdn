(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{897:function(e,t,n){"use strict";n.r(t);var r=n(6),o=(n(28),n(13),{head:function(){return{title:"抽奖控制台 - Saiblo"}},data:function(){return{web_socket:null,server:{open:!1,timeout:null,closing:!1},token:"",count:1,content:{enabled:!1,data:[]}}},mounted:function(){this.initWebSocket()},methods:{clearWebSocket:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==e.server.timeout&&(clearTimeout(e.server.timeout),e.server.timeout=null),null===e.web_socket){t.next=11;break}return e.server.open=!1,e.server.closing=!0,t.next=6,e.web_socket.close();case 6:if(!e.server.closing){t.next=11;break}return t.next=9,new Promise((function(e){return setTimeout(e,10)}));case 9:t.next=6;break;case 11:case"end":return t.stop()}}),t)})))()},initWebSocket:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.clearWebSocket();case 2:e.server.open=!0,e.web_socket=new WebSocket("wss://api.saiblo.net/lottery/0/base"),e.web_socket.onmessage=function(t){e.content=JSON.parse(t.data)},e.web_socket.onclose=function(){e.web_socket=null,e.server.open&&(e.server.timeout=setTimeout((function(){e.initWebSocket()}),3e3)),e.server.closing=!1};case 6:case"end":return t.stop()}}),t)})))()},sendMessage:function(e,t){this.web_socket.send(JSON.stringify({token:this.token,action:e,payload:t}))}}}),c=n(7),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("sui-grid",{staticStyle:{"margin-left":"-1em !important","margin-right":"-1em !important"},attrs:{stackable:""}},[n("sui-grid-row",[n("sui-grid-column",[n("sui-header",{tag:"h1"},[e._v("抽奖控制台")])],1)],1),e._v(" "),n("sui-grid-row",{staticClass:"f",staticStyle:{"flex-direction":"row-reverse"}},[n("sui-grid-column",{attrs:{width:4}},[n("sui-form",[n("sui-form-field",[n("sui-message",{class:"f sa",staticStyle:{"margin-bottom":"0","border-bottom-left-radius":"0","border-bottom-right-radius":"0"},attrs:{size:"mini"}},[e.web_socket&&1===e.web_socket.readyState?n("div",[e._v("已连接服务器")]):e.web_socket&&0===e.web_socket.readyState?n("div",[e._v("正在连接服务器")]):n("div",[e._v("未连接服务器")])]),e._v(" "),n("sui-progress",{attrs:{attached:"",state:"active",percent:"100",color:e.web_socket?1===e.web_socket.readyState?"green":0===e.web_socket.readyState?"yellow":"grey":"grey"}}),e._v(" "),n("sui-message",{class:"f sa",staticStyle:{"margin-bottom":"0","border-bottom-left-radius":"0","border-bottom-right-radius":"0"},attrs:{size:"mini"}},[e.content.enabled?n("div",[e._v("正在抽奖")]):n("div",[e._v("抽奖尚未开始")])]),e._v(" "),n("sui-progress",{attrs:{attached:"",state:"active",percent:"100",color:e.content.enabled?"green":"grey"}})],1),e._v(" "),n("sui-form-field",[n("div",{staticClass:"ui action input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.token,expression:"token"}],staticStyle:{width:"0"},attrs:{type:"password",placeholder:"输入密钥"},domProps:{value:e.token},on:{input:function(t){t.target.composing||(e.token=t.target.value)}}})])]),e._v(" "),n("sui-form-field",[n("div",{staticClass:"ui action input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.count,expression:"count"}],staticStyle:{width:"0"},attrs:{type:"number",placeholder:"输入中奖人数"},domProps:{value:e.count},on:{input:function(t){t.target.composing||(e.count=t.target.value)}}})])]),e._v(" "),n("sui-form-field",[n("sui-button",{attrs:{color:"blue",fluid:"",disabled:e.content.enabled||0===e.content.data.length},on:{click:function(t){return t.preventDefault(),e.sendMessage("clear")}}},[e._v("清空 ")])],1),e._v(" "),n("sui-form-field",[n("sui-button",{attrs:{color:"blue",fluid:"",disabled:e.content.enabled},on:{click:function(t){return t.preventDefault(),e.sendMessage("start")}}},[e._v("开始 ")])],1),e._v(" "),n("sui-form-field",[n("sui-button",{attrs:{color:"blue",fluid:"",disabled:!e.content.enabled||isNaN(Number(e.count))||Number(e.count)<=0},on:{click:function(t){t.preventDefault(),e.sendMessage("draw",Number(e.count))}}},[e._v("抽奖\n                        ")])],1)],1)],1),e._v(" "),n("sui-grid-column",{attrs:{width:12}},[0===e.content.data.length?n("sui-message",{attrs:{icon:"exclamation",header:"队列空空如也",info:""}}):e._e(),e._v(" "),e.content.data.length>0?n("sui-table",{attrs:{striped:""}},[n("sui-table-header",[n("sui-table-row",[n("sui-table-header-cell",[e._v("姓名")]),e._v(" "),n("sui-table-header-cell",{staticStyle:{width:"6em","text-align":"center"}},[e._v("中奖情况")])],1)],1),e._v(" "),n("transition-group",{attrs:{tag:"sui-table-body",name:"room_list"}},e._l(e.content.data,(function(t){var r=t.user,o=t.lucky;return n("sui-table-row",{key:r},[n("sui-table-cell",[e._v(e._s(r))]),e._v(" "),n("sui-table-cell",[o?n("sui-button",{attrs:{size:"mini",color:"green"}},[e._v("中奖")]):e._e()],1)],1)})),1)],1):e._e()],1)],1)],1)],1)}),[],!1,null,"44a010d8",null);t.default=component.exports}}]);